
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/offline/1_plot_gaze_pipeline.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_offline_1_plot_gaze_pipeline.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_offline_1_plot_gaze_pipeline.py:


.. _gaze_pipeline_example:

Gaze mapping pipeline
=====================

This example shows how to perform post-hoc pupil detection, calibration marker
detection, calibration and gaze mapping.

.. note::

    This example requires the dependencies for
    :ref:`pupil detection<pupil_detection_dependencies>` as well as
    ``matplotlib``.

.. GENERATED FROM PYTHON SOURCE LINES 16-19

.. code-block:: default

    import pupil_recording_interface as pri









.. GENERATED FROM PYTHON SOURCE LINES 20-22

Set recording folder
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 22-24

.. code-block:: default

    folder = pri.get_test_recording()





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Downloading file 'branch-v2.0.zip' from 'https://github.com/vedb/pupil-example-data/archive/refs/heads/branch-v2.0.zip' to '/home/runner/.cache/pupil-example-data'.
    Unzipping contents of '/home/runner/.cache/pupil-example-data/branch-v2.0.zip' to '/home/runner/.cache/pupil-example-data/branch-v2.0.zip.unzip'




.. GENERATED FROM PYTHON SOURCE LINES 25-27

Create readers for video streams
--------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 27-31

.. code-block:: default

    world_reader = pri.VideoReader(folder)
    eye0_reader = pri.VideoReader(folder, stream="eye0", color_format="gray")
    eye1_reader = pri.VideoReader(folder, stream="eye1", color_format="gray")








.. GENERATED FROM PYTHON SOURCE LINES 32-34

Detect pupils
-------------

.. GENERATED FROM PYTHON SOURCE LINES 34-40

.. code-block:: default

    pupil_detector_eye0 = pri.PupilDetector(camera_id=0)
    pupil_list_eye0 = pupil_detector_eye0.batch_run(eye0_reader)

    pupil_detector_eye1 = pri.PupilDetector(camera_id=1)
    pupil_list_eye1 = pupil_detector_eye1.batch_run(eye1_reader)








.. GENERATED FROM PYTHON SOURCE LINES 41-43

Detect calibration markers
--------------------------

.. GENERATED FROM PYTHON SOURCE LINES 43-46

.. code-block:: default

    marker_detector = pri.CircleDetector()
    marker_list = marker_detector.batch_run(world_reader)








.. GENERATED FROM PYTHON SOURCE LINES 47-49

Merge pupil data and run calibration
------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 49-53

.. code-block:: default

    calibration = pri.Calibration(resolution=world_reader.resolution)
    pupil_list = pri.merge_pupils(pupil_list_eye0, pupil_list_eye1)
    calibration_result = calibration.batch_run(pupil_list, marker_list)








.. GENERATED FROM PYTHON SOURCE LINES 54-56

Map gaze as dataset
-------------------

.. GENERATED FROM PYTHON SOURCE LINES 56-61

.. code-block:: default

    gaze_mapper = pri.GazeMapper(calibration=calibration_result)
    gaze = gaze_mapper.batch_run(
        pupil_list, return_type="dataset", info=world_reader.info
    )








.. GENERATED FROM PYTHON SOURCE LINES 62-64

Plot gaze
---------

.. GENERATED FROM PYTHON SOURCE LINES 64-66

.. code-block:: default

    norm_pos = gaze.gaze_norm_pos.where(gaze.gaze_confidence_2d > 0.7)
    norm_pos.plot.line(x="time")



.. image-sg:: /auto_examples/offline/images/sphx_glr_1_plot_gaze_pipeline_001.png
   :alt: 1 plot gaze pipeline
   :srcset: /auto_examples/offline/images/sphx_glr_1_plot_gaze_pipeline_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    [<matplotlib.lines.Line2D object at 0x7fc7d5b13828>, <matplotlib.lines.Line2D object at 0x7fc7d5ac8cf8>]




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  21.196 seconds)


.. _sphx_glr_download_auto_examples_offline_1_plot_gaze_pipeline.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: 1_plot_gaze_pipeline.py <1_plot_gaze_pipeline.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: 1_plot_gaze_pipeline.ipynb <1_plot_gaze_pipeline.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
